<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pastel Crush</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!-- ===== Pantalla 1: TÃ­tulo + Historial ===== -->
  <section id="screen-title" class="screen active">
    <div class="topbar">
      <div class="avatar-chip" id="chipTitle" style="visibility:hidden;">
        <div class="avatar-mini" id="miniTitle"></div>
        <div class="nickname" id="nickTitle">Jugador</div>
      </div>
      <div></div>
    </div>
    <div class="center-col">
      <div class="title">Pastel Crush</div>
      <div class="subtitle">Frutas, combos y poderes en 10 niveles + infinito</div>
      <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center; width:100%;">
        <button id="btnPlay" class="cta">ğŸ® Jugar</button>
        <button id="btnCustomize" class="cta" style="background:linear-gradient(180deg,#8fd3fe,#4fa7ff)">ğŸ§‘â€ğŸ¨ Personalizar</button>
      </div>
    </div>

    <div class="history">
      <h3>ğŸ† Historial de partidas</h3>
      <div id="historyContainer">
        <div class="history-empty">AÃºn no hay partidas. Â¡Juega tu primer nivel!</div>
      </div>
    </div>
  </section>

  <!-- ===== Pantalla 2: Constructor de Avatar ===== -->
  <section id="screen-avatar" class="screen">
    <div class="topbar">
      <div class="avatar-chip" id="chipAvatar" style="visibility:hidden;">
        <div class="avatar-mini" id="miniAvatar"></div>
        <div class="nickname" id="nickAvatar">Jugador</div>
      </div>
      <button id="btnAvatarToTitle" class="cta" style="background:linear-gradient(180deg,#b4b4b4,#8b8b8b)">â¬…ï¸ Volver</button>
    </div>

    <div class="builder">
      <div class="builder-canvas">
        <!-- Avatar SVG cartoon bÃ¡sico -->
        <svg id="avatarSvg" width="260" height="260" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg" aria-label="Avatar">
          <!-- Fondo circular -->
          <circle cx="100" cy="100" r="96" fill="#fff3f8"/>
          <!-- Piel -->
          <circle id="skin" cx="100" cy="100" r="60" fill="#F8D4B8"/>
          <!-- Pelo estilos -->
          <g id="hair_short">
            <path id="hairFill" d="M40,85 Q100,30 160,85 L160,70 Q100,20 40,70 Z" fill="#6B4E3D"/>
          </g>
          <g id="hair_long" style="display:none;">
            <path id="hairFillLong" d="M35,85 Q100,30 165,85 L165,145 Q100,175 35,145 Z" fill="#6B4E3D"/>
          </g>
          <!-- Ojos -->
          <g id="eyes_round" stroke="#333" stroke-width="3" fill="none">
            <circle id="eyeL" cx="78" cy="105" r="6" fill="#2b2b2b" />
            <circle id="eyeR" cx="122" cy="105" r="6" fill="#2b2b2b" />
          </g>
          <g id="eyes_sleepy" style="display:none;" stroke="#333" stroke-width="3" fill="none">
            <path id="eyeLs" d="M65 105 Q78 100 91 105" />
            <path id="eyeRs" d="M109 105 Q122 100 135 105" />
          </g>
          <!-- Boca -->
          <g id="mouth_smile">
            <path d="M75 125 Q100 140 125 125" stroke="#c44c6a" stroke-width="5" fill="none" stroke-linecap="round"/>
          </g>
          <g id="mouth_grin" style="display:none;">
            <path d="M70 125 Q100 150 130 125" stroke="#c44c6a" stroke-width="5" fill="#ffc9de" stroke-linecap="round"/>
          </g>
          <!-- Accesorio -->
          <g id="acc_hat" style="display:none;">
            <path d="M60 72 L140 72 L135 62 L65 62 Z" fill="#3a7bd5"/>
            <rect x="80" y="48" width="40" height="18" rx="6" fill="#4facfe"/>
          </g>
        </svg>
      </div>
      <div class="builder-controls">
        <div class="row"><label>Nickname</label><input id="nickInput" type="text" maxlength="14" placeholder="Tu nombre"/></div>
        <div class="row"><label>Pelo</label>
          <select id="selHair">
            <option value="short">Corto</option>
            <option value="long">Largo</option>
          </select>
          <input id="hairColor" type="color" value="#6B4E3D" title="Color de pelo"/>
        </div>
        <div class="row"><label>Ojos</label>
          <select id="selEyes">
            <option value="round">Redondos</option>
            <option value="sleepy">Dormilones</option>
          </select>
          <input id="eyeColor" type="color" value="#2B2B2B" title="Color de ojos"/>
        </div>
        <div class="row"><label>Boca</label>
          <select id="selMouth">
            <option value="smile">Sonrisa</option>
            <option value="grin">Sonrisa grande</option>
          </select>
        </div>
        <div class="row"><label>Accesorio</label>
          <select id="selAcc">
            <option value="none">Ninguno</option>
            <option value="hat">Gorro</option>
          </select>
        </div>
        <div class="row"><label>Piel</label><input id="skinColor" type="color" value="#F8D4B8"/></div>
        <div class="row" style="justify-content:flex-end; gap:10px;">
          <button id="btnSaveAvatar" class="cta">ğŸ’¾ Guardar</button>
          <button id="btnAvatarNext" class="cta">â¡ï¸ Siguiente</button>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== Pantalla 3: Historia / CÃ³mo jugar ===== -->
  <section id="screen-story" class="screen">
    <div class="topbar">
      <div class="avatar-chip" id="chipStory" style="visibility:hidden;">
        <div class="avatar-mini" id="miniStory"></div>
        <div class="nickname" id="nickStory">Jugador</div>
      </div>
      <button id="btnStoryBack" class="cta" style="background:linear-gradient(180deg,#b4b4b4,#8b8b8b)">â¬…ï¸ Volver</button>
    </div>
    <div class="center-col">
      <div class="title">Â¡Bienvenido a Pastel Crush! ğŸŒˆğŸ</div>
      <div class="subtitle" style="max-width:720px; line-height:1.55;">
        Recorre <b>10 niveles</b> cada vez mÃ¡s desafiantes. Haz <b>combos en cascada</b> para multiplicar tus puntos.
        Cuidado con las <b>bombas ğŸ’£</b> (penalizaciÃ³n pasiva) y los <b>bloqueadores â„ï¸</b> que se rompen con <b>dos</b> matches encima.
        Desde el <b>nivel 3</b> puede salir la <b>fruta arcoÃ­ris ğŸŒˆ</b> como comodÃ­n. Junta puntos para cargar <b>powerâ€‘ups</b>:
        ğŸ”¨ martillo, ğŸŒªï¸ remolino, ğŸŒŸ explosiÃ³n de color. Tras el nivel 10 â‡’ <b>modo infinito</b>.
      </div>
      <button id="btnStart" class="cta">âœ¨ Empezar</button>
    </div>
  </section>

  <!-- ===== Pantalla 4: Juego ===== -->
  <section id="screen-game" class="screen">
    <div class="topbar">
      <div class="avatar-chip" id="chipGame" style="visibility:hidden;">
        <div class="avatar-mini" id="miniGame"></div>
        <div class="nickname" id="nickGame">Jugador</div>
      </div>
      <button id="btnGameToTitle" class="cta" style="background:linear-gradient(180deg,#b4b4b4,#8b8b8b)">ğŸ  MenÃº</button>
    </div>

    <div class="game-wrap">
      <div style="position:relative; width: calc(var(--tile) * var(--board-size));">
        <div id="comboFx" class="combo-fx">Combo x2!</div>
      </div>
      <div id="board" class="board" aria-label="tablero de juego">
        <div class="grid-bg" id="grid-bg"></div>
      </div>

      <div class="hud" aria-live="polite">
        <div class="pill">Nivel <span id="level">1</span></div>
        <div class="pill big">Puntaje: <span id="score" class="accent">0</span> / <span id="target">200</span></div>
        <div class="pill" title="Vidas"><span id="lives">â¤ï¸â¤ï¸â¤ï¸</span></div>
        <div style="display:flex; gap:8px; justify-content:flex-end; align-items:center; flex-wrap:wrap;">
          <div class="pill" title="Tiempo restante">â±ï¸ <span id="time">45</span>s</div>
          <button id="restart">Reiniciar</button>
        </div>
      </div>

      <div class="powers">
        <div class="meter" title="Carga de power-up (200 pts)"><div id="meterFill"></div></div>
        <button id="pHammer" class="power-btn" title="ğŸ”¨ Martillo (rompe una ficha)">ğŸ”¨</button>
        <button id="pShuffle" class="power-btn" title="ğŸŒªï¸ Remolino (mezcla tablero)">ğŸŒªï¸</button>
        <button id="pColor" class="power-btn" title="ğŸŒŸ ExplosiÃ³n de color (borra un tipo)">ğŸŒŸ</button>
      </div>

      <details>
        <summary>ğŸ§ª Ver resultados de pruebas</summary>
        <pre id="test-log" style="background:#fff;border-radius:12px;padding:10px; overflow:auto; max-height:220px;"></pre>
      </details>
    </div>
  </section>

  <!-- Modal -->
  <div class="overlay" id="overlay" role="dialog" aria-modal="true">
    <div class="modal">
      <div id="modalIcon" style="font-size:42px;">ğŸ‰</div>
      <h2 id="modalTitle">Â¡Ganaste!</h2>
      <p id="modalText">Has alcanzado la meta. Â¿Listo para continuar?</p>
      <div class="actions" id="modalActions"></div>
    </div>
  </div>

  <script defer src="script.js"></script>
</body>
</html>
